# 베드 레벨링

베드레벨링(때로는 베드 트램밍tramming으로 불려지기도 한다)은 고품질 출력을 얻는데 결정적이다. 
만약 베드레벨이 제대로 맞춰져 있지 않으면 베드 안착에 문제가 생길 수 있다. 그래서 모서리 들뜸이나 프린트 전반에 걸친 자잘하나 문제들이 일어날 수 있다. 
이 문서는 클리퍼에서 베드레벨을 시행하는데 가이드를 제공한다. 

베드레벨링의 목표를 이해하는 것이 중요하다. 만약 프린터가 `X0 Y0 Z10` 위치로 가라고 명령을 받았다면
노즐은 프린터의 베드로 부터 정확히 10mm 위에 있어야 한다. 
연이어서 `X50 Z10`으로 이동하라고 명령을 하면 노즐은 베드와의 간격을 정확히 10mm 유지한 상태에서 수평으로 이동해야 한다. 

고품질 출력물을 얻기 위해 프린터는 약 0.025mm (25마이크로미터) 내의 정확도로 Z 높이를 캘리브레이션 해야 한다. 
이정도 거리는 보통의 사람 머리카락두께보다 훨씬 더 얇은 값이다. 
이 스케일은 눈으로는 측정될 수 없는 값이다. 열팽창와 같은 아주 미세한 것도 이정도 스케일에는 영향을 미칠 수 있다. 
높은 정확도의 레벨링을 얻을 수 있는 비밀은 반복에 있다. 그리고 프린터 자체의 모션시스템의 정확성을 이용하는데 있다. 

## 적절한 캘리브레이션 메카니즘을 선택하라

프린터들마다 각자 저마다의 베드레벨링 방식을 채택하고 있다. 
그것들 대부분은 결국에는 아래 기술한 "종이테스트"에 의존한다. 
특별한 타입의 프린터를 위한 실제 과정은 다른 문서에서 소개하겠다.

이 캘리브레이션 도구들을 이용하기전에 [config check document](Config_checks.md) 에 기재된 내용으로 꼭 체크해보기 바란다. 
베드레벨링을 하기 앞서 프린터의 기본동작상태를 점검하는 것은 필수적이다. 

오토레벨링센서가 장착된 프린터의 경우는 [Probe Calibrate](Probe_Calibrate.md) 문서에 있는 지시내용을 따라 반드시 캘리브레이션 하도록 하라. 
델타 프린터라면 [Delta Calibrate](Delta_Calibrate.md) 를 참고하기 바란다.
그리고, 베드나사와 전통적인 Z endstop 을 가진 프린터는 [Manual Level](Manual_Level.md) 문서를 참고하라.


캘리브레이션 할동안에는 프린터의 Z `position_min` (최소값)을 음수로 설정하도록 한다. (예, `position_min = -2`).
이것은 프린터가 캘리브레이션 중에도 경계를 체크하려고 하기 때문이다. 
최소 Z 위치를 음수값으로 설정해두면 프린터가 베드의 수평면 아래의 위치로 갈 수 있게 된다. 
이것은 정확한 실제 베드 위치를 결정하는데 도움을 줄 것이다. 

## "paper test" 종이테스트

기본적인 베드 캘리브레이션 메커니즘은 "종이테스트"이다. 
일단은 프린터의 베드와 노즐사이에 복사용지 한장을 놓는다. 
그리고 종이를 앞뒤로 밀었다 당겼다 하면서 노즐간의 미묘한 마찰을 느끼면서 노즐의 Z 높이를 변화시킨다. 

오토레벨링 센서가 있더라도 "종이테스트"의 방법을 이해하는 것은 중요하다. 
레벨링센서 그 자체도 좋은 레벨링을 위해서는 캘리브레이션 되어야 한다. 
레벨링센서의 캘리브레이션도 역시 "종이테스트" 를 이용한다. 

종이테스트를 하기 위해, 가위를 이용해 종이를 5x3cm 정도의 작은 직사각형 크기로 자른다. 
복사용지(A4)는 일반적으로 100마이크로메타(0.100mm) 두께를 가지고 있다. (종이 두께가 정확할 필요는 없다)

종이테스트의 첫번째 단계는 프린터 노즐과 베드를 잘 살펴보는 것이다. 
노즐과 베드에 남은 필라멘트찌꺼기들이 붙어 있지 않도록 하십시오. 

**노즐과 베드에 필라멘트찌꺼기가 붙어 있지 않은지 확인하라!**

만일 특별한 테이프나 베드표면위에서 항상 출력을 한다면 그 표면/테이프를 이용해 종이테스트를 할 것이다.
하지만, 테이프 자체의 두께가 각각 다를 수 있기 때문에 다른 테이프를 사용하거나 베드판을 바꾸거나 하면 Z 측정에 영향을 미치게 됨을 기억하라. 
그래서 반드시 실제 사용할 베드판이나 테이프를 깔고 종이테스트를 해야 한다. 

만일 노즐에 필라멘트가 붙어있다면 노즐 온도를 올리고 핀셋을 이용해 필라멘트를 제거하도록 하라. 
그리고, 노즐의 온도가 상온으로 완전히 식고 나면 종이테스트를 이어 진행한다. 
노즐이 식을 동안 필라멘트가 흘러 새어나온게 있다면 핀셋으로 제거하도록 한다. 

**종이테스트는 노즐과 베드의 온도가 모두 상온상태로 해놓고 진행하도록 한다.**


노즐이 히팅되면 열팽창에 의해 베드와의 상대적 높이가 변하게 된다. 
열팽창은 대체로 100 마이크론 전후가 된다. 이는 종이테스트를 진행하는 복사용지 두께에 해당한다. 
열팽창한 정확한 값은 복사용지 두께가 그랬던것처럼 결정적인 사항은 아니다. 
두개가 동일하다고 가정하고 종이테스트를 진행하면 된다. 
(두개 사이의 차이를 확인하는 방법은 아래를 참고하기 바란다.)

출력시 노즐이 히팅되어 있는 상황인데 출력 상태가 아닌 상온상태에서 베드/노즐간격을 캘리브레이션 하는것이 
이상하게 보일지도 모르겠다.  하지만, 만약 노즐이 히팅된 상태에서 캘리브레이션을 한다면 종이위에 아주 작은양의 녹은 필라멘트가 묻게 되고, 그것은 노즐과 종이와의 마찰을 다르게 할 것이다. 
그리고 그런 차이는 좋은 캘리브레이션을 얻는데 장애가 된다. 
베드와 노즐을 히팅시켜놓고 캘리브레이션을 하면 화상의 위험도 높아진다. 
열팽창 값은 안정적이며, 그렇기 때문에 이후 캘리브레이션 과정에서 쉽게 보정될 수 있다.

**정밀한 Z 높이를 결정하기 위해 자동화 툴을 사용하라!**

클리퍼는 몇가지 유용한 스크립트를 가지고 있다. 
(예. MANUAL_PROBE,Z_ENDSTOP_CALIBRATE, PROBE_CALIBRATE, DELTA_CALIBRATE). 
[자세한 내용](#choose-the-appropriate-calibration-mechanism) 은 링크를 참고하기 바란다.

옥토프린트 터미널창에서 적당한 명령어를 실행시켜라.
스크립트 실행을 하면 사용자가 확인할 수 있도록 옥토프린터 터미널 창에 아래와 같은 메시지를 띄울것이다. :

```
Recv: // Starting manual Z probe. Use TESTZ to adjust position.
Recv: // Finish with ACCEPT or ABORT command.
Recv: // Z position: ?????? --> 5.000 <-- ??????
```

현재 노즐높이(프린터가 현재 인식하고 있는)는 "--> <--" 표시 사이에 보여진다.
오른쪽 숫자는 현재 높이보다 큰, 최근 시도한 높이이다.
왼쪽의 숫자는 현재 높이보다 작은, 최근 시도한 높이이다. 
(어떤 시도도 없었다면 ?????? 가 표시될 것이다)

노즐과 베드사이에 종이를 둔다. 
종이 모서리를 살짝접어두면 손가락으로 종이를 잡기 쉬울 것이다. 
(종이를 앞뒤로 밀고 당길때 손으로 베드를 아래로 누르지 않도록 주의하라)

![종이테스트](img/paper-test.jpg)

노즐을 종이에 가깝게 붙도록 TESTZ 명령어를 사용하라. 
예를들어:

```
TESTZ Z=-.1
```

TESTZ 명령어는 노즐을 현재 위치로부터 상대적 거리로 움직이게 한다. 
(그래서, `Z=-.1` 명령은 노즐을 베드쪽으로 0.1mm 이동케 하는 요청이다.) 
노즐의 움직임이 멈춘후 노즐이 종이와 맞닿아 있는지 확인을 위해 종이를 앞뒤로 밀고 당겨보도록 하라.
그리고 마찰의 정도를 느껴보도록 하라. 
이때 마찰이 아주 작은 양이 느껴질때까지 TESTZ 명령을 계속한다. 

만일 너무 많은 마찰이 느껴지면 Z 값을 높여 노즐을 위로 올린다.
또한 이전 위치와 현재위치사이의 "중간위치"로 이동하려면 `TESTZ Z=+` 혹은 `TESTZ Z=-` 를 사용하면 된다. 
예를 들어, 만일 다음과 같은 내용을 TESTZ 명령으로 부터 결과로 받았다면:

```
Recv: // Z position: 0.130 --> 0.230 <-- 0.280
```

`TESTZ Z=-` 명령은 노즐을 0.180 (0.130 과 0.230 의 중간위치)으로 움직이게 될 것이다. 
이것은 적정 마찰력위치로 재빠르게 좁혀가기 위해 유용하게 사용될 수 있다. 

또한 `Z=++` 와 `Z=--` 명령이 있다. 이것은 과거 측정위치로 곧바로 돌아가게 한다. 
예를 들어, 위의 결과 메시지를 보고 `TESTZ Z=--` 명령을 하면 노즐은 0.130 위치로 이동하게 된다.

최종적으로 아주 작은 마찰력 위치를 찾게 되면 ACCEPT 명령을 내리면 된다. :

```
ACCEPT
```

이 ACCEPT 명령은 향후 주어진 Z 높이와 캘리브레이션 결과를 이용해 진행하게 될 것이다. 

정확한 마찰력의 느낌을 얻는게 결정적인것은 아니다. 마치 열팽창과 종이두께가 결정적인 요인이 아닌것과 마찬가지이다. 
단지 테스트할 때마다 동일한 정도의 마찰이 느껴지도록 하기만 하면 된다.

만약 테스트진행중 뭔가 잘못되고 있다면, 캘리브레이션 상태를 빠져나가기 위해 `ABORT` 명령을 사용하면 된다. 


## 열팽창도 결정하기 

여기까지 성공적으로 베드레벨링을 진행하였다면 
이제 "열팽창", "종이두께", "마찰력느낌"의 복합적인 영향을 고려한 정밀한 값을 계산할 수 있다. 
이 계산은 일반적으로는 필요치 않다. 대부분의 사용자들은 간단한 "종이테스트"만으로도 좋은 결과를 얻을 수 있을 것이다. 

이 계산의 가장 쉬운 방법은 모든 방향으로 직선의 벽을 가지고 있는 모델링의 테스트 출력을 해보는 것이다. 
큰 사이즈의 구멍난 사각형 모델링은 [docs/prints/square.stl](prints/square.stl) 에서 찾을 수 있다. 이것을 사용하면 된다. 
모델링파일을 슬라이싱 할 때 첫레이어와 그 다음레이어가 모두 동일한 층높이와 압출폭을 갖도록 설정하는 것을 잊지 말도록 한다. 두꺼운 층높이(노즐직경의 약 75% 두께)를 사용하고 브림과 라프트를 사용하지 않는다. 

테스트파일을 출력하고 식기를 기다려라, 그리고 베드로 부터 제거한다. 
이후 가장 낮은 첫레이어를 관찰한다. 
(손가락이나 손톱으로 아래쪽 모서리를 훑는 것도 좋은 방법이다)
하단 레이어가 네면을 따라 약간 튀어나와 있다면 노즐은 베드에 살짝 가깝다는 것을 의미한다. 
그러면 `SET_GCODE_OFFSET Z=+.010` 명령어를 이용해 노즐높이를 올리면 된다. 
이어진 출력에서 같은 행동을 반복하여 최적위치를 찾는다. 
이런 방식의 보정은 일반적으로 0.010mm 단위로 이루어진다.

만일 첫레이어가 이어진 레이어들에 비해 더 얇게 관찰이 된다면 SET_GCODE_OFFSET 명령을 이용해 Z 보정값을 음수로 두면 된다. 만약 확실치 않다고 느껴지면 첫레이어 모서리가 약간 튀어나올때까지 Z 보정값을 낮춰보라. 그리고, 그 튀어나온것이 사라질때까지 반대로 값을 주어 최적보정값을 찾을 수 있다.

최적의 Z 보정값을 찾는 가장 쉬운 방법은 START_PRINT g-code 매크로를 생성하는 것이다.
각 프린팅의 시작지점에 이 매크로를 불러와 출력을 진행한다. 그리고 이 매크로에 SET_GCODE_OFFSET 명령을 포함시키면 된다. 보다 더 자세한 내용은 [slicers](Slicers.md) 문서를 참고하기 바란다. 


